<?php?><script>function clearConfirm(){	if ( ! confirm("Clear All?") ) return false;	return true;}</script><?/*echo "<pre>";print_r($_REQUEST);echo "</pre>";*/include "config.php";# get dispatcher default state$myState = "";$strSQL = "SELECT fldMainState FROM tbluser WHERE fldID=".$_SESSION['userID'];$result = mysql_query($strSQL);$row = mysql_fetch_row($result);mysql_free_result($result);$myState = $row[0];# clear all for dispatchers state - no state set in profile resets all!if ( $_REQUEST['submit'] == "Clear" || $_REQUEST['submit'] == "Update" ){	$strSQL = "UPDATE tbluser SET fldOnline=0";	if ( $myState != "" ) $strSQL .= " WHERE fldMainState='$myState'";	mysql_query($strSQL);}# if passed cbx's set techs onlineif ( $_REQUEST['submit'] == "Update" ){	$eventdate = new DateTime();	$techs = array();	$keys = array_keys($_REQUEST);	for($cntr=0;$cntr<count($keys);$cntr++) if ( substr($keys[$cntr],0,3) == "cbx" ) 	{		array_push($techs, substr($keys[$cntr],3));		$strSQL = "INSERT INTO tbltechlog (`techId`,`event`,`eventDateTime`) VALUES ('".substr($keys[$cntr],3)."','1','".$eventdate->format('Y-m-d H:i:s')."')";		mysql_query($strSQL);	}	if ( count($techs) > 0 ) 	{		$strSQL = "UPDATE tbluser SET fldOnline=1 WHERE fldID IN (".implode(",",$techs).") ";		mysql_query($strSQL);	}	header("Location:index.php");}# build technologist query$strSQL = "	SELECT * FROM tbluser WHERE fldRole = 'technologist'";if ( $myState != "" ) $strSQL .= " AND fldMainState='$myState'";$strSQL .= " ORDER BY fldRealName";$result = mysql_query($strSQL);$rows = mysql_num_rows($result);$pntr=0;# display dispatch boardecho "<div style='background-color:#DEE7EF;'><center>";echo "<div class=header2>".trim($myState." Techs Online")."</div><br>";echo "<form action='' method='post'><table border=0>\n";for($cntr=0;$cntr<$rows;$cntr++){	if ( $pntr == 0 ) echo "<tr>\n";	$row = mysql_fetch_array($result);	$fldId = $row['fldID'];	echo "<td width=15px><input type='checkbox' name='cbx$fldId' value='1'";	if  ( $row[fldOnline] == 1 ) echo " checked";	echo "></td><td width=175px>".$row['fldRealName']."</td>\n";	$pntr++;	if ( $pntr > 4 )	{		echo "</tr>\n";		$pntr=0;	}}mysql_free_result($result);echo "</table>\n";echo "<table><tr><td>";echo "<input type=submit name=submit value=Update>\n";echo "</form>\n";echo "</td><td>";echo "<form action='' method='post' onsubmit='return clearConfirm()'><input name=submit type='submit' value='Clear'></form>";echo "</td></tr></table>";echo "</center><br></div\n";?>